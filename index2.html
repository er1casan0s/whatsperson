<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>What's Person? ‚Äî teste de personalidade visual</title>

  <!-- Favicon: SVG com emoji de pessoa üë§ (data URL) -->
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="86" font-size="90">üë§</text></svg>'>

  <!-- Estilo ‚Äî cores terap√™uticas (pastel azul / verde) e layout responsivo -->
  <style>
    /* ===== Paleta / vari√°veis ===== */
    :root{
      --bg: #f3fbfb;           /* fundo suave */
      --card: #ffffff;         /* cards brancos */
      --accent: #7fc3b3;       /* verde-√°gua */
      --accent-2: #8fbfe6;     /* azul suave */
      --muted: #6b7885;        /* texto secund√°rio */
      --primary-text: #0f2437;
      --glass: rgba(255,255,255,0.7);
      --shadow: 0 8px 24px rgba(15,36,55,0.08);
      --radius: 14px;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* ===== Layout ===== */
    html,body{height:100%; margin:0; background: linear-gradient(180deg,var(--bg), #eef8f7); color:var(--primary-text);}
    .container{max-width:980px; margin:32px auto; padding:24px; display:flex; gap:24px; flex-direction:column; align-items:center;}
    header{display:flex; align-items:center; gap:12px; width:100%; justify-content:center;}
    header h1{margin:0; font-size:28px;}
    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; width:100%;}

    /* ===== Tela inicial (email + nome) ===== */
    .start-grid{display:grid; grid-template-columns:1fr 1fr; gap:14px;}
    label{font-size:14px; color:var(--muted); display:block; margin-bottom:6px;}
    input[type="email"], input[type="text"]{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e6eef0; background:linear-gradient(180deg,#fff,#fbfeff);
      font-size:16px; box-sizing:border-box;
    }
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; padding:12px 16px; border-radius:12px; border:0; cursor:pointer; font-weight:600;}
    .muted{color:var(--muted); font-size:13px;}

    /* ===== Game area ===== */
    .game-area{display:flex; flex-direction:column; gap:18px; align-items:center;}
    .progress{width:100%; height:10px; background:#eaf6f5; border-radius:999px; overflow:hidden;}
    .progress > .bar{height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); width:0%; transition:width .4s ease;}
    .choices{display:flex; gap:18px; width:100%; justify-content:center; flex-wrap:wrap;}
    .choice{flex:1 1 320px; max-width:420px; border-radius:12px; overflow:hidden; cursor:pointer; display:flex; flex-direction:column; align-items:stretch; text-align:center; transition:transform .18s ease, box-shadow .18s ease;}
    .choice img{width:100%; height:320px; object-fit:cover; display:block;}
    .choice .caption{padding:12px; background:var(--glass); text-align:center;}
    .choice:hover{transform:translateY(-6px); box-shadow:0 18px 40px rgba(15,36,55,0.08);}

    /* ===== Result area ===== */
    .result {text-align:left;}
    .result h2{margin-top:0;}
    .tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
    .tag{background:#eff9f6; padding:6px 10px; border-radius:999px; color:var(--primary-text); font-weight:600; font-size:13px;}

    /* ===== Footer ===== */
    footer{width:100%; margin-top:18px; padding:12px 20px; border-radius:12px; background:linear-gradient(90deg,rgba(127,195,179,0.12),rgba(143,191,230,0.08)); display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;}
    .small{font-size:13px; color:var(--muted);}

    /* ===== Mobile tweaks ===== */
    @media (max-width:720px){
      .start-grid{grid-template-columns:1fr;}
      .choice img{height:220px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <!-- √çcone grande com üë§ e t√≠tulo -->
      <div style="font-size:40px; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; padding:10px; border-radius:10px;">üë§</div>
      <div style="text-align:left">
        <h1>What's Person?</h1>
        <div class="muted">Um jogo visual de personalidade ‚Äî escolha imagens e descubra seu perfil</div>
      </div>
    </header>

    <!-- === Card principal === -->
    <main class="card" id="app">

      <!-- TELA INICIAL -->
      <section id="startScreen">
        <h2>Antes de come√ßar</h2>
        <p class="muted">Insira seu e-mail para receber o relat√≥rio final (opcional) e diga como quer ser chamado(a).</p>

        <div class="start-grid" style="margin-top:10px;">
          <div>
            <label for="email">E-mail (relat√≥rio)</label>
            <input id="email" type="email" placeholder="seu@exemplo.com" />
            <div class="muted" style="margin-top:6px;">N√£o √© obrigat√≥rio ‚Äî voc√™ pode optar por enviar depois.</div>
          </div>

          <div>
            <label for="displayName">Como quer ser chamado(a)?</label>
            <input id="displayName" type="text" placeholder="Ex: Ana, Jo√£o, Dr. Pedro..." />
          </div>
        </div>

        <div style="display:flex; gap:12px; margin-top:16px; align-items:center;">
          <button class="btn" id="startBtn">Come√ßar teste</button>
          <button id="previewBtn" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Ver Sobre n√≥s</button>
        </div>

        <p class="muted" style="margin-top:12px;">O teste ter√° 15 escolhas. Leva ~5 minutos. As imagens s√£o apresentadas aleatoriamente.</p>
      </section>

      <!-- √ÅREA DO JOGO -->
      <section id="gameScreen" style="display:none;">
        <div style="width:100%; display:flex; justify-content:space-between; align-items:center;">
          <div>
            <strong id="greet">Ol√°!</strong>
            <div class="muted" id="roundText">Escolha a sua imagem preferida</div>
          </div>
          <div style="display:flex; gap:8px; align-items:center;">
            <button id="pauseMusic" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Pause m√∫sica</button>
            <div class="muted">Rodada <span id="roundNum">1</span>/15</div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div class="progress"><div class="bar" id="progressBar"></div></div>
        </div>

        <div class="game-area" style="margin-top:18px;">
          <div class="choices" id="choicesContainer">
            <!-- escolhas ser√£o injetadas aqui -->
          </div>

          <div class="muted" style="font-size:13px; text-align:center; margin-top:8px;">Clique na imagem que mais chama sua aten√ß√£o ‚Äî n√£o pense demais.</div>
        </div>
      </section>

      <!-- RESULTADO -->
      <section id="resultScreen" style="display:none;">
        <div class="result">
          <h2>Resultado</h2>
          <p id="resultSummary" class="muted">Analisando suas escolhas...</p>

          <div style="margin-top:12px;">
            <strong>Tra√ßos predominantes</strong>
            <div class="tags" id="resultTags"></div>
          </div>

          <div style="margin-top:18px; display:flex; gap:12px; flex-wrap:wrap;">
            <button id="sendEmailBtn" class="btn">Enviar relat√≥rio por e-mail</button>
            <button id="downloadBtn" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Baixar relat√≥rio (TXT)</button>
            <button id="retryBtn" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Refazer teste</button>
            <button id="aboutBtn" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Sobre n√≥s</button>
          </div>
        </div>
      </section>

      <!-- SOBRE N√ìS (modal simples) -->
      <section id="aboutModal" style="display:none; margin-top:14px;">
        <div style="padding:12px; border-radius:10px; background:linear-gradient(90deg,#ffffff, #fbffff); box-shadow:var(--shadow);">
          <h3>Sobre n√≥s</h3>
          <p class="muted" id="aboutText">
            <!-- Texto injetado via JS -->
          </p>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button id="closeAbout" class="btn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Fechar</button>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer com seus dados (Erica Santos, etc) -->
    <footer>
      <div class="small">Feito por Erica Santos ‚Äî Graduanda em Pedagogia ¬∑ Natal, RN</div>
      <div class="small">Projeto desenvolvido para fins acad√™micos ¬∑ What's Person?</div>
    </footer>
  </div>

  <!-- M√öSICA DE FUNDO: substitua src por um URL v√°lido ou arquivo local 'assets/relaxing-music.mp3' -->
  <audio id="bgMusic" loop>
    <!-- Por padr√£o deixamos sem src ‚Äî o autor do projeto deve colocar um arquivo -->
    <!-- <source src="assets/relaxing-music.mp3" type="audio/mp3"> -->
    Seu navegador n√£o suporta √°udio.
  </audio>

  <!-- ===== JAVASCRIPT ===== -->
  <script>
    /* =========================
       DESCRI√á√ÉO GERAL (em portugu√™s)
       - Este script controla todo o jogo: start, rodadas (15), embaralhamento de imagens,
         registro de escolhas, an√°lise final (mapeamento de tags -> perfil), relat√≥rio,
         envio por e-mail (instru√ß√µes para EmailJS fornecidas mais abaixo) e UI.
       - Coment√°rios explicam cada bloco.
       ========================= */

    // ----- Configura√ß√µes e banco de imagens (substitua URLs se desejar) -----
    // Cada imagem tem um 'id', 'url' e 'tags' (cada tag contribui para um tra√ßo).
    // As tags s√£o palavras de tra√ßo psicol√≥gico simplificado (ex: "criativo", "anal√≠tico", ...).
    // No final, somamos as tags escolhidas para gerar o perfil.
    const IMAGE_POOL = [
      // OBS: troque/adicione URLs reais (Unsplash / Pixabay / imagens pr√≥prias) conforme desejar.
      {id:1, url:"https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=900&q=60", tags:["calmo","introspectivo"]},
      {id:2, url:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=900&q=60", tags:["criativo","imaginativo"]},
      {id:3, url:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=900&q=60", tags:["aventuroso","extrovertido"]},
      {id:4, url:"https://images.unsplash.com/photo-1517816428104-94f3a8f20d5d?auto=format&fit=crop&w=900&q=60", tags:["anal√≠tico","objetivo"]},
      {id:5, url:"https://images.unsplash.com/photo-1505678261036-a3fcc5e884ee?auto=format&fit=crop&w=900&q=60", tags:["emp√°tico","afetuoso"]},
      {id:6, url:"https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?auto=format&fit=crop&w=900&q=60", tags:["l√∫dico","brincalh√£o"]},
      {id:7, url:"https://images.unsplash.com/photo-1456324504439-367cee3b3c32?auto=format&fit=crop&w=900&q=60", tags:["detalhista","preciso"]},
      {id:8, url:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=900&q=60", tags:["sereno","paciente"]},
      {id:9, url:"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=900&q=60", tags:["ambicioso","decidido"]},
      {id:10, url:"https://images.unsplash.com/photo-1517816743773-6e0fd518b4a6?auto=format&fit=crop&w=900&q=60", tags:["espiritual","reflexivo"]},
      {id:11, url:"https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=900&q=60", tags:["social","comunicativo"]},
      {id:12, url:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=900&q=60", tags:["art√≠stico","inovador"]},
      {id:13, url:"https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=900&q=60", tags:["tranquilo","equilibrado"]},
      {id:14, url:"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=900&q=60", tags:["competitivo","energ√©tico"]},
      {id:15, url:"https://images.unsplash.com/photo-1454165205744-3b78555e5572?auto=format&fit=crop&w=900&q=60", tags:["observador","curioso"]},
      {id:16, url:"https://images.unsplash.com/photo-1472214103451-9374bd1c798e?auto=format&fit=crop&w=900&q=60", tags:["acolhedor","colaborativo"]},
      {id:17, url:"https://images.unsplash.com/photo-1518806118471-f28b20a1d79d?auto=format&fit=crop&w=900&q=60", tags:["espont√¢neo","flex√≠vel"]},
      {id:18, url:"https://images.unsplash.com/photo-1506248891683-46b51b5b4b4a?auto=format&fit=crop&w=900&q=60", tags:["met√≥dico","organizado"]},
      {id:19, url:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=900&q=60", tags:["imaginativo","sonhador"]},
      {id:20, url:"https://images.unsplash.com/photo-1445295029076-4c2f0cc2abf6?auto=format&fit=crop&w=900&q=60", tags:["determinado","resiliente"]}
    ];

    // N√∫mero de rodadas (escolhas) ‚Äî conforme solicitado, 15.
    const TOTAL_ROUNDS = 15;

    // Estado do jogo
    let state = {
      email: "",
      name: "",
      round: 0,
      selections: [], // armazena objetos da forma {imageId, tags}
      usedImageIds: new Set()
    };

    // ----- Helpers -----
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return document.querySelectorAll(sel); }

    // Embaralha um array e retorna c√≥pia
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Seleciona duas imagens aleat√≥rias e diferentes do pool, evitando reutilizar j√° usadas quando poss√≠vel
    function pickTwoUnique(){
      // cria pool filtrado por imagens ainda n√£o usadas (para variar ao longo do jogo)
      let available = IMAGE_POOL.filter(img => !state.usedImageIds.has(img.id));
      // se n√£o houver suficientes dispon√≠veis, permita reutilizar (reinicia o conjunto)
      if(available.length < 2) available = IMAGE_POOL.slice();
      const shuffled = shuffle(available);
      const chosen = [shuffled[0], shuffled[1]];
      // marca como usadas
      chosen.forEach(img => state.usedImageIds.add(img.id));
      return chosen;
    }

    // Atualiza progress bar UI
    function updateProgress(){
      const pct = Math.round((state.round / TOTAL_ROUNDS) * 100);
      $("#progressBar").style.width = pct + "%";
      $("#roundNum").textContent = Math.min(state.round+1, TOTAL_ROUNDS);
    }

    // ===== UI: iniciar jogo =====
    $("#startBtn").addEventListener("click", () => {
      // l√™ inputs
      state.email = $("#email").value.trim();
      state.name = $("#displayName").value.trim() || "Voc√™";

      // mostra sauda√ß√£o curta
      $("#greet").textContent = `Ol√°, ${state.name}!`;

      // esconde tela inicial, mostra jogo
      $("#startScreen").style.display = "none";
      $("#gameScreen").style.display = "block";

      // iniciar m√∫sica (se houver)
      const music = document.getElementById("bgMusic");
      try { music.play().catch(()=>{/* autoplay pode ser bloqueado; deixamos bot√£o para controlar */}); } catch(e){}

      // iniciar estado
      state.round = 0;
      state.selections = [];
      state.usedImageIds = new Set();

      // render primeira escolha
      renderNextChoice();
      updateProgress();
    });

    // Preview "Sobre n√≥s"
    $("#previewBtn").addEventListener("click", () => showAbout());

    // Bot√£o para pausar/reproduzir m√∫sica
    $("#pauseMusic").addEventListener("click", () => {
      const m = document.getElementById("bgMusic");
      if(m.paused){ m.play().catch(()=>{}); $("#pauseMusic").textContent = "Pause m√∫sica"; }
      else { m.pause(); $("#pauseMusic").textContent = "Reproduzir m√∫sica"; }
    });

    // renderiza as duas imagens para o usu√°rio escolher
    function renderNextChoice(){
      const container = $("#choicesContainer");
      container.innerHTML = ""; // limpa
      // se j√° completou as rodadas, mostra resultado
      if(state.round >= TOTAL_ROUNDS){
        showResult();
        return;
      }

      // pega duas imagens aleat√≥rias
      const [a,b] = pickTwoUnique();

      // cria os elementos de escolha (imagem + legenda opcional)
      [a,b].forEach(img=>{
        const div = document.createElement("div");
        div.className = "choice cardlike";
        div.innerHTML = `
          <img src="${img.url}" alt="imagem ${img.id}" loading="lazy" />
          <div class="caption muted">Clique para escolher</div>
        `;
        // clique seleciona
        div.addEventListener("click", () => {
          // registra sele√ß√£o
          state.selections.push({imageId:img.id, tags:img.tags});
          state.round++;
          updateProgress();
          // renderiza pr√≥xima (ou resultado)
          renderNextChoice();
        });
        container.appendChild(div);
      });
    }

    // ===== An√°lise final =====
    function analyzeSelections(){
      // soma frequ√™ncias de tags
      const counter = {};
      state.selections.forEach(sel=>{
        sel.tags.forEach(t=>{
          counter[t] = (counter[t] || 0) + 1;
        });
      });

      // transforma em array ordenado por contagem decrescente
      const ranked = Object.entries(counter).sort((a,b)=>b[1]-a[1]);

      // pega top 3 tra√ßos
      const top = ranked.slice(0,3).map(r=>r[0]);

      // mapeamento de perfis simplificado (exemplo): combinamos tags para um r√≥tulo mais amplo
      const profileScores = {
        "Introvertido Calmo": (counter["calmo"]||0) + (counter["introspectivo"]||0) + (counter["sereno"]||0),
        "Criativo / Imaginativo": (counter["criativo"]||0) + (counter["imaginativo"]||0) + (counter["art√≠stico"]||0),
        "Extrovertido / Social": (counter["extrovertido"]||0) + (counter["social"]||0) + (counter["comunicativo"]||0),
        "Anal√≠tico / Organizado": (counter["anal√≠tico"]||0) + (counter["met√≥dico"]||0) + (counter["organizado"]||0),
        "Emp√°tico / Acolhedor": (counter["emp√°tico"]||0) + (counter["acolhedor"]||0),
        "Aventureiro / Energ√©tico": (counter["aventuroso"]||0) + (counter["competitivo"]||0) + (counter["energ√©tico"]||0)
      };

      // escolhe perfil com maior pontua√ß√£o
      const bestProfile = Object.entries(profileScores).sort((a,b)=>b[1]-a[1])[0];

      // cria resumo psicol√≥gico com base nos tra√ßos
      let summary = "";
      if(!bestProfile || bestProfile[1] === 0){
        summary = "Seu padr√£o de escolhas sugere um perfil equilibrado, com inclina√ß√µes variadas. Voc√™ provavelmente aprecia diversidade e n√£o se identifica fortemente com um √∫nico estilo.";
      } else {
        const profileName = bestProfile[0];
        const explanation = generateProfileExplanation(profileName, top);
        summary = explanation;
      }

      return { counter, ranked, top, summary };
    }

    // Gera texto descritivo para cada perfil (baseado em psicologia popular ‚Äî n√£o substitui avalia√ß√£o profissional)
    function generateProfileExplanation(profileName, topTraits){
      // explica√ß√µes curtas para cada perfil
      const explanations = {
        "Introvertido Calmo": `Seu padr√£o indica prefer√™ncia por calma, reflex√£o e profundidade. Pessoas com esse perfil costumam recarregar em ambientes tranquilos, valorizam a introspec√ß√£o e t√™m forte consci√™ncia emocional. Tra√ßos principais: ${topTraits.join(", ")}.`,
        "Criativo / Imaginativo": `Voc√™ tende a ver o mundo com imagina√ß√£o e originalidade. Gosta de nova√ß√£o, aprecia est√©tica e frequentemente resolve problemas com solu√ß√µes n√£o convencionais. Tra√ßos principais: ${topTraits.join(", ")}.`,
        "Extrovertido / Social": `Voc√™ se energiza com intera√ß√£o social e experi√™ncias din√¢micas. Provavelmente se comunica com facilidade e busca conex√£o com grupos. Tra√ßos principais: ${topTraits.join(", ")}.`,
        "Anal√≠tico / Organizado": `Voc√™ valoriza ordem, precis√£o e l√≥gica. Racioc√≠nio estruturado e aten√ß√£o ao detalhe s√£o pontos fortes ‚Äî √≥timo em tarefas que exigem planejamento. Tra√ßos principais: ${topTraits.join(", ")}.`,
        "Emp√°tico / Acolhedor": `Prioriza rela√ß√µes e suporte emocional. Sua sensibilidade faz de voc√™ um bom ouvinte e mediador. Tra√ßos principais: ${topTraits.join(", ")}.`,
        "Aventureiro / Energ√©tico": `Busca novidade e a√ß√£o. Gosta de desafios, mudan√ßa e atividades que testem seus limites. Tra√ßos principais: ${topTraits.join(", ")}.`
      };
      return explanations[profileName] || `Perfil: ${profileName}. Tra√ßos: ${topTraits.join(", ")}.`;
    }

    // Mostra resultado na UI
    function showResult(){
      // oculta jogo, mostra resultado
      $("#gameScreen").style.display = "none";
      $("#resultScreen").style.display = "block";

      const analysis = analyzeSelections();

      // popula tags e resumo
      const tagsDiv = $("#resultTags");
      tagsDiv.innerHTML = "";
      // mostra top 4 tra√ßos
      analysis.ranked.slice(0,4).forEach(([tag,count])=>{
        const span = document.createElement("div");
        span.className = "tag";
        span.textContent = `${tag} √ó ${count}`;
        tagsDiv.appendChild(span);
      });

      $("#resultSummary").textContent = analysis.summary;
    }

    // Bot√µes do resultScreen
    $("#retryBtn").addEventListener("click", () => {
      // reinicia para refazer o teste
      $("#resultScreen").style.display = "none";
      $("#startScreen").style.display = "block";
      // opcional: limpa campos (mant√©m e-mail e nome)
    });

    $("#aboutBtn").addEventListener("click", showAbout);
    $("#closeAbout").addEventListener("click", () => { $("#aboutModal").style.display = "none"; });

    // Prepara texto do sobre n√≥s (usamos o conte√∫do que voc√™ pediu)
    const aboutText = `
      <strong>What's Person?</strong><br>
      Este projeto foi desenvolvido como atividade acad√™mica para o curso de Pedagogia. 
      O objetivo √© oferecer uma experi√™ncia interativa que permite que o usu√°rio explore 
      aspectos de sua personalidade por meio de escolhas visuais. O relat√≥rio final 
      apresenta um resumo interpretativo baseado nas imagens escolhidas ‚Äî uma aproxima√ß√£o 
      inspirada em conceitos psicol√≥gicos, mas que n√£o substitui uma avalia√ß√£o profissional.
      <br><br>
      Autora: Erica Santos ‚Äî Graduanda em Pedagogia, Natal RN.
    `;
    $("#aboutText").textContent = ""; // evita inje√ß√£o cruza de HTML ‚Äî mas queremos mostrar HTML
    document.getElementById("aboutText").innerHTML = aboutText;

    function showAbout(){
      // exibe a se√ß√£o modal de sobre n√≥s
      $("#aboutModal").style.display = "block";
      // se estamos no resultado, n√£o escondemos ‚Äî √© complementar
    }

    // ===== Relat√≥rio e envio de e-mail =====
    // Gera texto do relat√≥rio baseado nas escolhas e an√°lise
    function generateReportText(){
      const analysis = analyzeSelections();
      const lines = [];
      lines.push(`What's Person? ‚Äî Relat√≥rio de personalidade`);
      lines.push(`Nome: ${state.name}`);
      lines.push(`E-mail (informado): ${state.email || "n√£o informado"}`);
      lines.push(`Data: ${new Date().toLocaleString()}`);
      lines.push("");
      lines.push("Tra√ßos detectados (frequ√™ncia):");
      Object.entries(analysis.counter || {}).forEach(([tag,count])=>{
        lines.push(`- ${tag}: ${count}`);
      });
      lines.push("");
      lines.push("Resumo interpretativo:");
      lines.push(analysis.summary);
      lines.push("");
      lines.push("Observa√ß√µes: Este relat√≥rio √© uma interpreta√ß√£o geral baseada nas escolhas visuais. Para an√°lise cl√≠nica, procure um psic√≥logo qualificado.");
      return lines.join("\n");
    }

    // Bot√£o baixar relat√≥rio (gera arquivo TXT)
    $("#downloadBtn").addEventListener("click", () => {
      const text = generateReportText();
      const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `whats-person-relatorio-${(state.name||"usuario").replace(/\s+/g,"_")}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Bot√£o enviar e-mail ‚Äî tentamos EmailJS (se configurado), sen√£o fallback para mailto
    $("#sendEmailBtn").addEventListener("click", () => {
      const email = state.email;
      const reportText = generateReportText();

      if(!email){
        // sem e-mail informado ‚Äî informar usu√°rio
        if(!confirm("Voc√™ n√£o informou um e-mail. Deseja abrir o cliente de e-mail para enviar o relat√≥rio manualmente?")) return;
      }

      // A) EmailJS (CLIENT-side). Para usar:
      // 1) Crie conta em https://www.emailjs.com
      // 2) Crie um servi√ßo de e-mail (ex: Gmail/SMTP) e um template com campo 'message'
      // 3) Substitua os valores abaixo (YOUR_SERVICE_ID, YOUR_TEMPLATE_ID, YOUR_PUBLIC_KEY)
      // 4) Descomente o bloco abaixo (c√≥digo de envio).
      //
      // Exemplo de integra√ß√£o (comentar/descomentar quando tiver IDs):
      /*
      (function(){
        // Carregar SDK EmailJS dinamicamente (se ainda n√£o carregado)
        if(typeof emailjs === "undefined"){
          const s = document.createElement("script");
          s.src = "https://cdn.emailjs.com/sdk/3.2.0/email.min.js";
          s.onload = () => {
            emailjs.init("YOUR_PUBLIC_KEY"); // substituir
            // enviar
            emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{
              to_email: state.email,
              to_name: state.name,
              message: reportText
            }).then(() => alert("Relat√≥rio enviado por e-mail!"), (err)=> alert("Falha ao enviar: "+err.text));
          };
          document.body.appendChild(s);
        } else {
          emailjs.init("YOUR_PUBLIC_KEY");
          emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{
            to_email: state.email,
            to_name: state.name,
            message: reportText
          }).then(()=>alert("Relat√≥rio enviado por e-mail!"), (err)=> alert("Falha ao enviar: "+err.text));
        }
      })();
      return;
      */

      // B) Fallback: abrir cliente de e-mail com mailto: (pr√©-preenche corpo e assunto)
      // Observa√ß√£o: mailto tem limite de tamanho e depende do cliente do usu√°rio.
      const subject = encodeURIComponent("Relat√≥rio ‚Äî What's Person?");
      const body = encodeURIComponent(reportText);
      // caso tenha email informado, preenche "to", caso contr√°rio apenas abre o body para copiar/colar
      const mailto = (email ? `mailto:${encodeURIComponent(email)}?subject=${subject}&body=${body}` : `mailto:?subject=${subject}&body=${body}`);
      window.location.href = mailto;
    });

    // ===== Inicializa√ß√£o =====
    // (1) Preencha a fonte de m√∫sica: se voc√™ quiser que o site toque uma faixa de fundo automaticamente,
    //     coloque um arquivo em /assets/relaxing-music.mp3 e descomente a linha abaixo:
    //
    // document.getElementById("bgMusic").src = "assets/relaxing-music.mp3";
    //
    // (2) Se preferir usar URL online (ex: mp3 hospedado) coloque o link em src.
    //
    // Aviso sobre autoplay: muitos navegadores bloqueiam autoplay com som ‚Äî por isso h√° bot√£o para pausar/reproduzir.
    //
    // ===== FIM =====

    // Opcional: definir um arquivo de m√∫sica padr√£o (comentado por padr√£o)
    // document.getElementById("bgMusic").src = "assets/relaxing-music.mp3";

  </script>
</body>
</html>
